image: Visual Studio 2017
version: '{build}'
clone_depth: 100
skip_branch_with_pr: true

# For debugging
init:
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

install:
  - ps: cinst -y miktex
  - ps: cinst -y pandoc --version 1.17.2
  - cmd:  refreshenv

build_script:
  - build.bat no-pause
  - cd docs
  - cmd: call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"
  - rake

test_script:
  - cd msvc/build
  - ctest -C Release --output-on-failure -E shadetest  # CI can't do GPU calcs at this time
